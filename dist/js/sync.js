const a4_0x3df612=a4_0x2029;(function(_0x2c43e7,_0x4fc81e){const _0xe51ce0=a4_0x2029,_0xd99f23=_0x2c43e7();while(!![]){try{const _0x57f92a=-parseInt(_0xe51ce0(0x159))/0x1+parseInt(_0xe51ce0(0x151))/0x2*(-parseInt(_0xe51ce0(0x16b))/0x3)+-parseInt(_0xe51ce0(0x169))/0x4+parseInt(_0xe51ce0(0x172))/0x5+parseInt(_0xe51ce0(0x16a))/0x6+parseInt(_0xe51ce0(0x162))/0x7*(-parseInt(_0xe51ce0(0x16d))/0x8)+parseInt(_0xe51ce0(0x170))/0x9*(parseInt(_0xe51ce0(0x150))/0xa);if(_0x57f92a===_0x4fc81e)break;else _0xd99f23['push'](_0xd99f23['shift']());}catch(_0x589c47){_0xd99f23['push'](_0xd99f23['shift']());}}}(a4_0x2f91,0xf0ad1));import{firebaseConfig}from'./config.js';!firebase[a4_0x3df612(0x15f)][a4_0x3df612(0x152)]&&firebase[a4_0x3df612(0x156)](firebaseConfig);export const db=firebase[a4_0x3df612(0x165)]();export const auth=firebase['auth']();export const provider=new firebase[(a4_0x3df612(0x15c))][(a4_0x3df612(0x15e))]();export let mySchedule=JSON['parse'](localStorage[a4_0x3df612(0x174)](a4_0x3df612(0x157)))||[];export let lastUpdated=parseInt(localStorage[a4_0x3df612(0x174)](a4_0x3df612(0x154)))||0x0;let unsubSnapshot=null,isFirstSyncAfterLogin=![];const syncStatus=document['getElementById'](a4_0x3df612(0x171));function a4_0x2029(_0x43a600,_0x93b18c){_0x43a600=_0x43a600-0x14f;const _0x2f91ae=a4_0x2f91();let _0x202976=_0x2f91ae[_0x43a600];return _0x202976;}export const updateLocalState=_0xa31bbd=>{const _0x5dc8e2=a4_0x3df612;mySchedule=_0xa31bbd,lastUpdated=Date['now'](),localStorage['setItem'](_0x5dc8e2(0x157),JSON[_0x5dc8e2(0x160)](mySchedule)),localStorage['setItem'](_0x5dc8e2(0x154),lastUpdated[_0x5dc8e2(0x161)]());};export const pushToCloud=async()=>{const _0x404269=a4_0x3df612,_0x37719e=auth[_0x404269(0x14f)];if(!_0x37719e)return;if(syncStatus)syncStatus['innerText']=_0x404269(0x15a);try{await db[_0x404269(0x16e)](_0x404269(0x167))['doc'](_0x37719e[_0x404269(0x173)])[_0x404269(0x158)]({'data':mySchedule,'lastUpdated':lastUpdated});if(syncStatus)syncStatus[_0x404269(0x16f)]='synced';}catch(_0x16b6c2){console[_0x404269(0x163)](_0x404269(0x176),_0x16b6c2);if(syncStatus)syncStatus[_0x404269(0x16f)]=_0x404269(0x155);}};const handleCloudChange=(_0xa80c8a,_0x19ba1c)=>{const _0x132ca6=a4_0x3df612;if(!_0xa80c8a[_0x132ca6(0x166)]){if(mySchedule[_0x132ca6(0x152)]>0x0)pushToCloud();isFirstSyncAfterLogin=![];return;}const _0x132c52=_0xa80c8a[_0x132ca6(0x168)](),_0x410cd8=_0x132c52[_0x132ca6(0x164)]||0x0;if(isFirstSyncAfterLogin){mySchedule[_0x132ca6(0x152)]=0x0,mySchedule[_0x132ca6(0x153)](..._0x132c52[_0x132ca6(0x168)]||[]),lastUpdated=_0x410cd8,localStorage[_0x132ca6(0x16c)](_0x132ca6(0x157),JSON['stringify'](mySchedule)),localStorage['setItem'](_0x132ca6(0x154),lastUpdated[_0x132ca6(0x161)]());if(_0x19ba1c)_0x19ba1c();if(syncStatus)syncStatus[_0x132ca6(0x16f)]='cloud\x20sync\x20activated';isFirstSyncAfterLogin=![];return;}if(_0x410cd8>lastUpdated){mySchedule['length']=0x0,mySchedule['push'](..._0x132c52['data']||[]),lastUpdated=_0x410cd8,localStorage[_0x132ca6(0x16c)](_0x132ca6(0x157),JSON[_0x132ca6(0x160)](mySchedule)),localStorage['setItem'](_0x132ca6(0x154),lastUpdated['toString']());if(_0x19ba1c)_0x19ba1c();if(syncStatus)syncStatus[_0x132ca6(0x16f)]=_0x132ca6(0x15d);}else{if(lastUpdated>_0x410cd8)pushToCloud();else{if(syncStatus)syncStatus[_0x132ca6(0x16f)]='synced';}}};function a4_0x2f91(){const _0x18d26b=['40UpPysV','collection','innerText','27441noibiN','sync-status','8473010yhOaLW','uid','getItem','offline','Cloud\x20push\x20failed:','currentUser','9430NLoALw','4UJEops','length','push','balangkas_updated','sync\x20error','initializeApp','balangkas_sched','set','1512369iXawgQ','syncing...','onAuthStateChanged','auth','synced\x20(updated)','GoogleAuthProvider','apps','stringify','toString','1895831nUypdz','error','lastUpdated','firestore','exists','schedules','data','5474044FfdbOK','11407614IXkzYv','1875336lUsbXG','setItem'];a4_0x2f91=function(){return _0x18d26b;};return a4_0x2f91();}export const startSyncListener=_0x250c0d=>{const _0x2c6281=a4_0x3df612;auth[_0x2c6281(0x15b)](_0x4ce3d8=>{const _0xeb13b2=_0x2c6281;if(_0x4ce3d8)isFirstSyncAfterLogin=!![],unsubSnapshot=db[_0xeb13b2(0x16e)]('schedules')['doc'](_0x4ce3d8[_0xeb13b2(0x173)])['onSnapshot'](_0x5b0d0f=>{handleCloudChange(_0x5b0d0f,_0x250c0d);});else{if(unsubSnapshot)unsubSnapshot();isFirstSyncAfterLogin=![];if(syncStatus)syncStatus[_0xeb13b2(0x16f)]=_0xeb13b2(0x175);}});};