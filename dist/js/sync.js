const a5_0x55b413=a5_0x35e6;(function(_0x3bc81d,_0x2d548f){const _0x14cdc3=a5_0x35e6,_0xcc8b6c=_0x3bc81d();while(!![]){try{const _0x4d6a9a=-parseInt(_0x14cdc3(0xdc))/0x1+-parseInt(_0x14cdc3(0xf8))/0x2*(parseInt(_0x14cdc3(0xe9))/0x3)+-parseInt(_0x14cdc3(0xf4))/0x4*(parseInt(_0x14cdc3(0xe2))/0x5)+parseInt(_0x14cdc3(0xee))/0x6*(-parseInt(_0x14cdc3(0xfd))/0x7)+parseInt(_0x14cdc3(0xea))/0x8+-parseInt(_0x14cdc3(0xd9))/0x9*(parseInt(_0x14cdc3(0xfe))/0xa)+parseInt(_0x14cdc3(0xed))/0xb*(parseInt(_0x14cdc3(0xf0))/0xc);if(_0x4d6a9a===_0x2d548f)break;else _0xcc8b6c['push'](_0xcc8b6c['shift']());}catch(_0x58ea9e){_0xcc8b6c['push'](_0xcc8b6c['shift']());}}}(a5_0x531c,0xc54ca));import{firebaseConfig}from'./config.js';!firebase['apps'][a5_0x55b413(0xdd)]&&firebase[a5_0x55b413(0xf9)](firebaseConfig);export const db=firebase[a5_0x55b413(0xdf)]();export const auth=firebase[a5_0x55b413(0xdb)]();export const provider=new firebase[(a5_0x55b413(0xdb))]['GoogleAuthProvider']();export let mySchedule=JSON['parse'](localStorage['getItem'](a5_0x55b413(0x100)))||[];export let lastUpdated=parseInt(localStorage['getItem']('balangkas_updated'))||0x0;let unsubSnapshot=null,isFirstSyncAfterLogin=![];function a5_0x531c(){const _0x1c2df5=['2fDCXco','initializeApp','setItem','push','set','7fBDQca','49930hLYMrD','getElementById','balangkas_sched','1926wpZply','lastUpdated','auth','1141447RNYEbp','length','innerText','firestore','sync\x20error','schedules','3275qwAkpm','exists','uid','doc','now','synced','stringify','1670343PlqPbQ','11430168FTmzuf','data','syncing...','55tYzlFG','9661218KFaXzJ','toString','11426568irsftU','onAuthStateChanged','error','collection','6136gWmehz','offline','balangkas_updated','currentUser'];a5_0x531c=function(){return _0x1c2df5;};return a5_0x531c();}const syncStatus=document[a5_0x55b413(0xff)]('sync-status');export const updateLocalState=_0x13e788=>{const _0x36c6f1=a5_0x55b413;mySchedule=_0x13e788,lastUpdated=Date[_0x36c6f1(0xe6)](),localStorage[_0x36c6f1(0xfa)](_0x36c6f1(0x100),JSON[_0x36c6f1(0xe8)](mySchedule)),localStorage[_0x36c6f1(0xfa)](_0x36c6f1(0xf6),lastUpdated[_0x36c6f1(0xef)]());};function a5_0x35e6(_0x4b207e,_0xd65a31){_0x4b207e=_0x4b207e-0xd9;const _0x531cf7=a5_0x531c();let _0x35e66f=_0x531cf7[_0x4b207e];return _0x35e66f;}export const pushToCloud=async()=>{const _0x2a761a=a5_0x55b413,_0x125027=auth[_0x2a761a(0xf7)];if(!_0x125027)return;if(syncStatus)syncStatus[_0x2a761a(0xde)]=_0x2a761a(0xec);try{await db[_0x2a761a(0xf3)](_0x2a761a(0xe1))[_0x2a761a(0xe5)](_0x125027[_0x2a761a(0xe4)])[_0x2a761a(0xfc)]({'data':mySchedule,'lastUpdated':lastUpdated});if(syncStatus)syncStatus[_0x2a761a(0xde)]=_0x2a761a(0xe7);}catch(_0xf26c64){console[_0x2a761a(0xf2)]('Cloud\x20push\x20failed:',_0xf26c64);if(syncStatus)syncStatus[_0x2a761a(0xde)]=_0x2a761a(0xe0);}};const handleCloudChange=(_0x505ade,_0x561e06)=>{const _0x4eca3d=a5_0x55b413;if(!_0x505ade[_0x4eca3d(0xe3)]){if(mySchedule[_0x4eca3d(0xdd)]>0x0)pushToCloud();isFirstSyncAfterLogin=![];return;}const _0x5d653a=_0x505ade[_0x4eca3d(0xeb)](),_0x4076c4=_0x5d653a[_0x4eca3d(0xda)]||0x0;if(isFirstSyncAfterLogin){mySchedule[_0x4eca3d(0xdd)]=0x0,mySchedule['push'](..._0x5d653a['data']||[]),lastUpdated=_0x4076c4,localStorage[_0x4eca3d(0xfa)](_0x4eca3d(0x100),JSON[_0x4eca3d(0xe8)](mySchedule)),localStorage[_0x4eca3d(0xfa)](_0x4eca3d(0xf6),lastUpdated[_0x4eca3d(0xef)]());if(_0x561e06)_0x561e06();if(syncStatus)syncStatus[_0x4eca3d(0xde)]='cloud\x20sync\x20activated';isFirstSyncAfterLogin=![];return;}if(_0x4076c4>lastUpdated){mySchedule[_0x4eca3d(0xdd)]=0x0,mySchedule[_0x4eca3d(0xfb)](..._0x5d653a['data']||[]),lastUpdated=_0x4076c4,localStorage['setItem'](_0x4eca3d(0x100),JSON['stringify'](mySchedule)),localStorage[_0x4eca3d(0xfa)](_0x4eca3d(0xf6),lastUpdated[_0x4eca3d(0xef)]());if(_0x561e06)_0x561e06();if(syncStatus)syncStatus[_0x4eca3d(0xde)]='synced\x20(updated)';}else{if(lastUpdated>_0x4076c4)pushToCloud();else{if(syncStatus)syncStatus[_0x4eca3d(0xde)]=_0x4eca3d(0xe7);}}};export const startSyncListener=_0x530477=>{const _0x18ed9c=a5_0x55b413;auth[_0x18ed9c(0xf1)](_0xcab722=>{const _0x4dfdcf=_0x18ed9c;if(_0xcab722)isFirstSyncAfterLogin=!![],unsubSnapshot=db['collection']('schedules')[_0x4dfdcf(0xe5)](_0xcab722[_0x4dfdcf(0xe4)])['onSnapshot'](_0x4236cf=>{handleCloudChange(_0x4236cf,_0x530477);});else{if(unsubSnapshot)unsubSnapshot();isFirstSyncAfterLogin=![];if(syncStatus)syncStatus['innerText']=_0x4dfdcf(0xf5);}});};